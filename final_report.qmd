---
title: "An analysis on Leatherback, Green and Loggerhead sea turtle bycatch from ICES 2017-2023 data"
subtitle: "Completed for the final report for EVR 628"
author: "Caitlin Coyle"
format: 
  html:
    toc: true
---

## Introduction 
Green sea turtles, leatherback sea turtles, and loggerhead sea turtles are endangered species listed on the ICUN red list. Their vulnerability in population sizes makes bycatch an important metric for analyzing threats to the three species. Using bycatch data from ICES ecoregions from 2017-2023, we will investigate the levels of bycatch per species and region, as well as understand what kinds of gear are the most problematic. 

- Turtle exclusion devices are not currently required in countries outisde of the United States to limit bycatch impact, and therefore we could use this data to promote the use of TEDs within other countries, specifically ICES ecoregions 

## Objectives
- Accumulate numbers for total bycatch by cleaning the data 
- Analyze areas in which bycatch are the highest per species 
- Map the geographical data for the two species with highest bycatch
- Analyze the findings to gather suggestions for lawmakers and scientists 


## Data Source
- `data/raw` folder contains the : ICES. 2024. Bycatch of endangered, threatened and protected species of marine 
mammals, seabirds and marine turtles, and selected fish species of bycatch relevance. 
In Report of the ICES Advisory Committee, 2024. ICES Advice 2024, 
byc.eu. [https://doi.org/10.17895/ices.advice.27999401](https://doi.org/10.17895/ices.advice.27999401) 
    - `data/processed` is where `turtle_bycatch_clean.rds` can be found which shows bycatch totals, species, gear type used, and ecoregion it was caught in
- `scripts/processing` shows `data_processing.r` with the script to clean the data and produce `turtle_bycatch_clean.rds`
- `scripts/content` shows `data_visualization.r` script that shows the plots of the data and `spatial_data_visualization.r` which maps the bycatch data over spatial data
Snippet of the`turtle_bycatch_clean.rds` data: 
```{r}
library(readxl)
library(readr)
data_test <- read_rds("data/processed/turtle_bycatch_clean.rds")
head(data_test)
```


## Data Processing 
1. Firstly, I took the raw data and used the `library(janitor)` package to clean the names of the column, rename some columns with confusing titles, and make a new column that created a combined total bycatch to make plotting easier 
2. Secondly, I cleaned out columns that were irrelevant to the question I was trying to answer and used `mutate` and `filter` functions for the data to only have sea turtles, since other species are included in the raw data.
3. Lastly, it was executed to the `data/processed` folder
*Using code from the `data_visualization.r` and `spatial_data_visualization.r` scripts*
```{r}
#| message: false
#| error: false
#| code-fold: true
#| fig-cap: "shows plots of turtle bycatch by gear type and ecoregion"
#Load packages------------------------------------
library(tidyverse)
library(dplyr)
library(stringr)
library (cowplot)#used for additonal cleaning

#Load Data-----------------------------------------
turtle_bycatch <- read_rds("data/processed/turtle_bycatch_clean.rds")
view(turtle_bycatch) #checking data

# Fix a capitalization error
turtle_bycatch <- turtle_bycatch |>
  mutate(species_common_name = str_to_sentence(species_common_name))
view(turtle_bycatch) #only noticed when I made the plot

## VISUALIZING THE DATA-----------------------------------------

# Building a plot that shows bycatch per ecoregion
p1 <- ggplot(data = turtle_bycatch,
             mapping = aes(x = total_bycatch, y = ecoregion, fill = species_common_name)) +
  geom_col(fill = "cadetblue", color = "black") + #had some issues with the black lines
  facet_wrap(~species_common_name, scales = "free_x") + #showing facet wrap
  labs(
    title = "Turtle Bycatch by Species (2017-2023)",
    x = "Total Bycatch",
    y = "Species",
    caption = "Data from ICES survey, 2024") +
  theme_minimal(base_size = 12) +
   theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),  # use linewidth instead of size
    panel.spacing = unit(1, "lines")) #additional work for cleanliness

print(p1) #view the new plot

# EXPORT PLOT AS A PNG
ggsave(plot = p1,
       filename = "results/img/turtle_ecoregion.png")

# SECOND PLOT: shows turtle bycatch per gear type used
## Since data for loggerhead > leatherback and green, facet will be used again
p2 <- ggplot(turtle_bycatch, aes(x = total_bycatch, y = gear_type,
                                 color = gear_type)) +
  geom_jitter(width = 0.2, size = 3, alpha = 0.7) +
  facet_wrap(~species_common_name, scale = "free") +
  labs(
    title = "Turtle Bycatch by Gear Type (2017-2023)",
    x = "Total Bycatch",
    y = "Gear Type",
    color = "Gear Type",
    caption = "Data sourced from ICES, 2024"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),  # use linewidth instead of size
    panel.spacing = unit(1, "lines"))

print(p2)

```

The next steps were to configure a map using spatial data from ICES ecoregions in order to overlay the bycatch data with physical mapping coordinates to better visualize the areas where bycatch is occuring and at which densities
4. Downloading the packages required to work with vector data, like `library(mapview)`, `library(ggspatial)`, `library(sf)`,`library(rnaturalearth)` 
5. In order to do a `left_join` for the spatial data and the bycatch data, I had to preform some minor cleanings using the `stringr` package and `janitor` packages
6. Then I was able to `left_join` both data sets in order to use the `sf` function and render a visual map, which can be seen below
```{r}
#| echo: false
#| message: false
#| error: false
#| fig-cap: "Shows the bycatch by ecoregion for Green sea turtle and Loggerhead"
# LOAD PACKAGES
library(ggspatial) #for ggplot visualization
library(rnaturalearth) #for mapping baselayer
library(viridis) #for the final ggplot
library(janitor) #for cleaning capitalization error
library(tidyverse)
library(readxl) #used to read rds from files
library(sf) #used for vector data from ICES ecoregions shapefile
library(mapview) #for visualization
library(stringr) #for joining data sets by ecoregion label

# LOAD DATA
## Load data for ecoregions from ICES using sf
ecoregions <- read_sf("data/raw/ICES_ecoregions /ICES_ecoregions_20171207_erase_ESRI.shp")

## Loading data from visualization assignment
turtle_data <- read_rds("data/processed/turtle_bycatch_clean.rds") |>
  clean_names() |>
  rename(Ecoregion = ecoregion)

# Clean the ecoregion names to avoid mismatch issues
ecoregions <- ecoregions |>
  mutate(Ecoregion = str_to_lower(str_trim(Ecoregion)))

turtle_data <- turtle_data |>
  mutate(Ecoregion = str_to_lower(str_trim(Ecoregion)))

# Clean the turtle data to ensure no duplicates for the ecoregions (mismatched values)
turtle_data_clean <- turtle_data |>
  group_by(Ecoregion, species_common_name) |>
  summarize(
    total_bycatch = sum(total_bycatch, na.rm = TRUE),
    .groups = "drop")

# Join the two files since turtle_bycatch has no spatial data to plot
eco_turtle <- ecoregions |>
  left_join(turtle_data_clean, by = "Ecoregion")

# Showing only polygons with bycatch data
eco_turtle_bycatch <- eco_turtle |>
  filter(!is.na(total_bycatch)) |>
  st_make_valid()

# Filtering the data to show only green sea turtles due to vast size and detail of the data (too large)
green_turtle <- eco_turtle_bycatch |>
  filter(species_common_name == "Green Sea Turtle") |>
  st_make_valid()  # to check and ensure it works!

# Filtering the data to separate loggerhead and green sea turtle (most commonly caught)
loggerhead <- eco_turtle_bycatch |>
  filter(species_common_name == "Loggerhead") |>
  st_make_valid()

# Combine into one sf object for easier plotting
both_species <- bind_rows(green_turtle, loggerhead)

# Simplifying geometry for easier and faster vector plotting
both_species_simple <- st_simplify(both_species, dTolerance = 0.05)

# Loading the world basemap before setting zoom
world <- ne_countries(scale = "medium", returnclass = "sf")

#make a bounding box for the polygons
bbox_all <- st_bbox(both_species_simple)
x_pad <- (bbox_all$xmax - bbox_all$xmin) * 0.1
y_pad <- (bbox_all$ymax - bbox_all$ymin) * 0.1

#Create the faceted map in order to show both polygons in different species
p <- ggplot() +
  geom_sf(data = world, fill = "grey92", color = "white", size = 0.3) +
  geom_sf(
    data = both_species_simple,
    aes(fill = total_bycatch),
    color = "black",
    size = 0.5,
    alpha = 0.85) +
  scale_fill_viridis_c(option = "D", direction = 1,
                       name = "Total\nBycatch") +
# Scale bar + north arrow
annotation_scale(location = "bl", width_hint = 0.25, line_width = 0.8) +
annotation_north_arrow(location = "tl",
                       height = unit(1.2, "cm"),
                       width = unit(1.2, "cm"),
                       pad_x = unit(0.4, "cm"),
                       pad_y = unit(0.4, "cm"),
                       style = north_arrow_fancy_orienteering) +
# Zoom into needed area
coord_sf(
  xlim = c(bbox_all$xmin - x_pad, bbox_all$xmax + x_pad),
  ylim = c(bbox_all$ymin - y_pad, bbox_all$ymax + y_pad),
  expand = FALSE) +
# Facet by species for easier visualization
facet_wrap(~ species_common_name) +
# Adding labels
labs(
  title = "Sea Turtle Bycatch by ICES Ecoregion 2017-2023",
  subtitle = "Comparison of Loggerhead and Green Sea Turtle Bycatch",
  caption = "Data: ICES Ecoregions & Turtle Bycatch Monitoring Dataset") +
theme_minimal(base_size = 14) +
theme(
  plot.title = element_text(face = "bold", size = 18),
  plot.subtitle = element_text(size = 13, margin = margin(b = 10)),
  legend.position = "right",
  panel.grid = element_line(color = "grey90"),
  axis.title = element_blank())
ggsave("results/img/turtle_bycatch_map.png",p) 
plot(p)
```


## Main Findings 
- Loggerhead sea turtles had a outstandingly high volume of bycatch, most notably from the Adriatic Sea with just under 3,000 individuals from otter trawl 
- Leatherback turtles highest bycatch count was from the Azores with a total of 36 individuals, from longlines 
  - Longlines were also responsible for the most bycatch for green sea turtles, with their totals of 131 individuals from the Aegean-Levantine Sea 
From these findings, we might conclude that there is a need for TED or other forms of protection against bycatch for these two commonly caught turtle species.

## References 
ICES. 2024. Bycatch of endangered, threatened and protected species of marine 
mammals, seabirds and marine turtles, and selected fish species of bycatch relevance. 
In *Report of the ICES Advisory Committee, 2024*. ICES Advice 2024, byc.eu.  
[https://doi.org/10.17895/ices.advice.27999401](https://doi.org/10.17895/ices.advice.27999401)
